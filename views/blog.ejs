<!DOCTYPE html>
<html lang="en">
<%- include('./commun/head') %>
<style>
  a {
    text-decoration: none;
  }

  ul {
    list-style-type: none;
  }

  .wrap__article-detail-content p {
    line-height: 28px;
    color: #333;
  }

  p.has-drop-cap-container {
    width: 80%;
    max-width: 50em;
    margin: 0 auto;
    line-height: 28px;
    margin-bottom: 1.5em;
  }


  .btn-social.telegram {
    background-color: #179cde;
  }

  .btn-social {
    font-size: 16px;
    width: 35px;
    height: 35px;
    text-align: center;
    padding: 0 !important;
    border-radius: 0;
    margin: 0 auto;
    line-height: 32px;
    display: inline-block;
  }

  .btn-social i {
    margin-right: 0;
  }

  .btn-social.facebook {
    background-color: #3b5999;
  }

  .btn-social.twitter {
    background-color: #55acee;
  }

  .btn-social.linkedin {
    background-color: #0077b5;
  }

  .btn-social.instagram {
    background-color: #d91cac;
  }

  .btn-social.whatsapp {
    background-color: #07be4de0;
  }

  .btn-social.btn-social-o {
    color: #fff;
  }

  .breadcrumbs {
    padding: 15px;
  }

  .breadcrumbs__item {
    display: inline-block;
    font-size: 14px;
    font-weight: 600;
    text-transform: capitalize;
    font-family: Montserrat, sans-serif;
  }

  .breadcrumbs__item:last-child:after {
    display: none;
  }

  .breadcrumbs__item i {
    font-size: 14px;
  }

  .breadcrumbs__item:after {
    content: "\f105";
    font-family: FontAwesome;
    display: inline-block;
    position: relative;
    font-size: 14px;
    margin: 0 6px;
  }

  .breadcrumbs__url {
    color: #000;
  }

  .breadcrumbs__item--current {
    color: #c00;
  }

  .blog-tags {
    padding: 15px 0;
    display: inline-block;
  }

  .blog-tags .list-inline {
    margin-bottom: 0;
  }

  .blog-tags .list-inline .list-inline-item {
    margin-right: 0;
  }

  .blog-tags .list-inline .list-inline-item .fa-tags {
    margin-right: 10px;
    text-align: center;
    position: relative;
    color: #c00;
  }

  .blog-tags .list-inline .list-inline-item span {
    display: block;
    margin-bottom: 5px;
    padding: 7px 10px;
    border: 1px solid #ddd;
    margin-right: 2px;
    color: #000;
    text-decoration: none;
    text-transform: uppercase;
    font-size: 11px;
    letter-spacing: 1px;
    font-family: Montserrat, sans-serif;
  }

  .wrap__profile {
    border: 1px solid #ddd;
    padding: 20px;
    position: relative;
    display: -webkit-box;
    display: flex;
    margin-bottom: 50px;
  }

  .wrap__profile-author {
    display: -webkit-box;
    display: flex;
  }

  .wrap__profile-author figure {
    width: 150px;
    height: auto;
    display: block;
    margin-right: 10px;
  }

  .wrap__profile-author figure img {
    max-width: 100%;
    height: auto;
    -o-object-fit: cover;
    object-fit: cover;
    position: relative;
  }

  .wrap__profile-author-detail {
    float: left;
  }

  .wrap__profile-author-detail-name {
    text-transform: uppercase;
    color: #6c757d;
    letter-spacing: 1px;
    font-family: Montserrat, sans-serif;
    font-size: 12px;
    font-weight: 700;
    margin-bottom: 5px;
  }

  .wrap__profile-author-detail h4 {
    text-transform: capitalize;
  }

  .wrap__profile-author-detail .list-inline {
    margin: 0;
  }

  .wrap__profile-author-detail .list-inline .list-inline-item {
    margin-bottom: 10px;
  }

  .wrap__profile-author-detail .list-inline .list-inline-item .btn-social.telegram {
    background: #179cde;
  }

  .comments-area .comments-title {
    font-size: 22px;
    margin-bottom: 25px;
    margin-top: 30px;
  }

  .comments-area ol {
    padding: 0;
    margin: 0;
    list-style-type: none;
  }

  .comments-area .comment-list {
    padding: 0;
    margin: 0;
    list-style-type: none;
  }

  .comments-area .children {
    margin-left: 65px;
  }

  .comments-area .children .comment-respond {
    padding: 0 25px;
  }

  .comments-area .comment-body {
    border-bottom: 1px solid #eee;
    margin-left: 65px;
    font-size: 14px;
    margin-bottom: 20px;
    padding-bottom: 20px;
  }

  .comments-area .comment-body .reply {
    margin-top: 15px;
  }

  .comments-area .comment-body .reply a,
  #load-more-comments,
  .load-more-reply {
    color: #fff;
    font-family: Montserrat, sans-serif;
    display: inline-block;
    padding: 5px 20px 6px;
    cursor: pointer;
    background: #c00;
    font-size: 13px;
    position: relative;
    z-index: 1;
  }

  #load-more-comments,
  .load-more-reply {
    margin: 0 0 40px 0;
  }

  .comments-area .comment-body .reply a::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: #d72924;
    opacity: 0;
    visibility: hidden;
    -webkit-transition: 0.5s;
    transition: 0.5s;
    border-radius: 30px;
    z-index: -1;
  }

  .comments-area .comment-meta {
    margin-bottom: 1em;
  }

  .comments-area .comment-author {
    font-size: 15px;
    margin-bottom: 0.4em;
    position: relative;
    z-index: 2;
  }

  .comments-area .comment-author .avatar {
    height: 50px;
    left: -65px;
    position: absolute;
    width: 50px;
  }

  .comments-area .comment-author p {
    font-weight: 700;
  }

  .comments-area .comment-author i {
    margin-left: 10px;
    color: #495057;
  }

  .comments-area .comment-metadata {
    text-transform: uppercase;
    font-size: 13px;
    font-family: Montserrat, sans-serif;
    color: #495057;
  }

  .comments-area .comment-metadata span {
    font-family: Montserrat, sans-serif;
    color: #495057;
  }

  .comments-area .comment-content p {
    font-size: 14px;
  }

  .comments-area .comment-respond {
    background: #fafafa;
    padding: 30px 25px;
    overflow: hidden;
    border: 1px solid #eee;
    margin-bottom: 40px;
  }

  .comments-area .comment-respond .comment-reply-title {
    margin-top: 0;
    margin-bottom: 0;
    font-size: 20px;
  }

  .comments-area .comment-respond .comment-notes {
    font-size: 15px;
    margin-bottom: 0;
    margin-top: 10px;
  }

  .comments-area .comment-respond .comment-form-comment {
    margin-top: 15px;
    float: left;
    width: 100%;
  }

  .comments-area .comment-respond label {
    display: block;
    margin-bottom: 10px;
  }

  .comments-area .comment-respond input[type="email"] {
    display: block;
    width: 100%;
    border: 1px solid #eee;
    padding: 0.625em 0.7375em;
    outline: 0;
    -webkit-transition: 0.5s;
    transition: 0.5s;
  }

  .comments-area .comment-respond input[type="text"] {
    display: block;
    width: 100%;
    border: 1px solid #eee;
    padding: 0.625em 0.7375em;
    outline: 0;
    -webkit-transition: 0.5s;
    transition: 0.5s;
  }

  .comments-area .comment-respond input[type="url"] {
    display: block;
    width: 100%;
    border: 1px solid #eee;
    padding: 0.625em 0.7375em;
    outline: 0;
    -webkit-transition: 0.5s;
    transition: 0.5s;
  }

  .comments-area .comment-respond textarea {
    display: block;
    width: 100%;
    border: 1px solid #eee;
    padding: 0.625em 0.7375em;
    outline: 0;
    -webkit-transition: 0.5s;
    transition: 0.5s;
  }

  .comments-area .comment-respond .comment-form-author {
    float: left;
    width: 50%;
    padding-right: 10px;
    margin-bottom: 20px;
  }

  .comments-area .comment-respond .comment-form-email {
    float: left;
    width: 50%;
    padding-left: 12px;
    margin-bottom: 20px;
  }

  .comments-area .comment-respond .comment-form-url {
    float: left;
    width: 100%;
    margin-bottom: 20px;
  }

  .comments-area .comment-respond .comment-form-cookies-consent {
    width: 100%;
    float: left;
    position: relative;
    padding-left: 20px;
    margin-bottom: 20px;
  }

  .comments-area .comment-respond .comment-form-cookies-consent input {
    position: absolute;
    left: 0;
    top: 7px;
  }

  .comments-area .comment-respond .comment-form-cookies-consent label {
    display: inline-block;
    margin: 0;
    font-weight: 400;
  }

  .comments-area .comment-respond .form-submit {
    float: left;
    width: 100%;
  }

  .comments-area .comment-respond .form-submit button,
  .comments-area .comment-respond .form-submit span {
    background: #d72924;
    border: 1px solid #d72924;
    color: #fff;
    padding: 11px 25px;
    display: inline-block;
    cursor: pointer;
    outline: 0;
    border-radius: 0;
    text-transform: uppercase;
    -webkit-transition: 0.5s;
    transition: 0.5s;
    position: relative;
    z-index: 1;
    font-weight: 600;
    font-size: 14px;
  }

  .wrap__article-detail-info .list-inline {
    padding: 0;
  }

  .wrap__article-detail-info .list-inline .list-inline-item {
    margin-right: 0;
  }

  .wrap__article-detail-info .list-inline .list-inline-item .image-profile {
    width: 40px;
    max-width: 100%;
    margin-bottom: 0;
    margin-right: 8px;
  }

  .wrap__article-detail-info .list-inline .list-inline-item .image-profile img {
    position: relative;
    width: 100%;
    height: auto;
    border-radius: 50%;
    -o-object-fit: cover;
    object-fit: cover;
  }

  .wrap__article-detail-info .list-inline .list-inline-item a,
  .wrap__article-detail-info .list-inline .list-inline-item span {
    font-family: Montserrat, sans-serif;
    text-transform: capitalize;
    font-weight: 600;
    font-size: 14px;
  }

  .wrap__article-detail-content {
    position: relative;
    display: block;
  }

  .wrap__article-detail-content .total-views {
    float: left;
    position: relative;
    display: block;
    width: 100%;
  }

  .wrap__article-detail-content .total-views .total-views-read {
    font-size: 30px;
    font-weight: 700;
    display: inline-block;
    color: #343a40;
    text-align: center;
    margin-right: 5px;
  }

  .wrap__article-detail-content .total-views .total-views-read span {
    display: block;
    margin-top: -5px;
    font-size: 16px;
    font-weight: 400;
  }

  .wrap__article-detail-content .total-views .list-inline {
    padding-top: 15px;
    float: right;
  }

  .wrap__article-detail-content .total-views .list-inline .list-inline-item {
    margin: 0;
  }

  .wrap__article-detail-content .total-views .list-inline .list-inline-item .instagram,
  .wrap__article-detail-content .total-views .list-inline .list-inline-item .facebook,
  .wrap__article-detail-content .total-views .list-inline .list-inline-item .linkedin,
  .wrap__article-detail-content .total-views .list-inline .list-inline-item .telegram,
  .wrap__article-detail-content .total-views .list-inline .list-inline-item .twitter,
  .wrap__article-detail-content .total-views .list-inline .list-inline-item .whatsapp {
    padding: 7px 14px;
    margin-bottom: 5px;
    color: #fff;
  }

  .wrap__article-detail-content .total-views .list-inline .list-inline-item .instagram span,
  .wrap__article-detail-content .total-views .list-inline .list-inline-item .facebook span,
  .wrap__article-detail-content .total-views .list-inline .list-inline-item .linkedin span,
  .wrap__article-detail-content .total-views .list-inline .list-inline-item .telegram span,
  .wrap__article-detail-content .total-views .list-inline .list-inline-item .twitter span,
  .wrap__article-detail-content .total-views .list-inline .list-inline-item .whatsapp span {
    color: #fff;
    font-family: Montserrat, sans-serif;
    text-transform: capitalize;
    font-weight: 600;
    font-size: 12px;
  }

  .wrap__article-detail-content .total-views .list-inline .list-inline-item .facebook {
    background: #3b5999;
  }

  .wrap__article-detail-content .total-views .list-inline .list-inline-item .twitter {
    background: #55acee;
  }

  .wrap__article-detail-content .total-views .list-inline .list-inline-item .whatsapp {
    background: #25d366;
  }

  .wrap__article-detail-content .total-views .list-inline .list-inline-item .telegram {
    background: #179cde;
  }

  .wrap__article-detail-content .total-views .list-inline .list-inline-item .linkedin {
    background: #0077b5;
  }

  .wrap__article-detail-content .total-views .list-inline .list-inline-item .instagram {
    background: #d91cac;
  }

  .single_navigation-next,
  .single_navigation-prev {
    display: block;
  }

  .single_navigation-next a,
  .single_navigation-prev a {
    font-family: Montserrat, sans-serif;
    color: #000;
    font-weight: 600;
  }

  .single_navigation-next a span,
  .single_navigation-prev a span {
    display: block;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 2.5px;
    color: #7e7e7e;
    margin-bottom: 12px;
    -webkit-transition: all 0.3s ease-in-out;
    transition: all 0.3s ease-in-out;
  }

  .single_navigation-next {
    margin-bottom: 80px;
  }

  .single_navigation-prev {
    margin-bottom: 80px;
  }
</style>

<body class="bg-light">
  <%- include('./partials/navbar') %>
  <section class="mt-140px ">
    <div class="container">
      <!-- Breadcrumb -->
      <ul class="breadcrumbs mb-4 text-center">
        <li class="breadcrumbs__item">
          <a class='breadcrumbs__url' href='/home'>
            <i class="fa fa-home"></i> Home</a>
        </li>
        <li class="breadcrumbs__item">
          <a class='breadcrumbs__url' href='/blogs'>Blogs</a>
        </li>
        <li class="breadcrumbs__item breadcrumbs__item--current">
          <%= blog.title%>
        </li>
      </ul>
      <div class="row">
        <div class="col-lg-12">
          <div class="go__explore-title">
            <h1 class="Blog-title-Block"><%= blog.title%></h1>
            <p><%= blog.subtitle%></p>
          </div>

          <hr>
          <div class="wrap__article-detail-info">
            <ul class="list-inline">

              <% if (blog.autor && blog.autor.fullname) { %>
              <li class="list-inline-item">
                <figure class="image-profile">

                  <% if (blog.autor.autorIMGpath !== "images/Default-profile.jpg") { %>
                  <img src="<%= blog.autor.autorIMGpath.replace('attachments\\', '') %>" alt="">
                  <% } else { %>
                  <img src="<%= blog.autor.autorIMGpath %>" alt="">
                  <% } %>

                </figure>
              </li>
              <li class="list-inline-item">
                <span>
                  by
                </span>
                <%= blog.autor.fullname%>
              </li>
              <% } %>


              <li class="list-inline-item">
                <span class="text-dark text-capitalize ml-1">
                  <%= blog.updatedAt.toDateString()%>
                </span>
              </li>
            </ul>
          </div>

          <figure class="article_cover text-center">
            <img src="<%= blog.coverIMGpath.replace('attachments\\', '')%>" alt="blog cover" class="img-fluid">
          </figure>

          <div class="wrap__article-detail-content ">
            <div class="total-views">
              <div class="total-views-read">
                +<%= (blog.nb_views / 1000).toFixed(1) %>k
                <span>
                  views
                </span>
              </div>


              <ul class="list-inline">
                <li class="list-inline-item">
                  <a class="btn btn-social-o facebook shfacebook" target="blank">
                    <i class="fa-brands fa-facebook-f"></i>
                    <span>Facebook</span>
                  </a>
                </li>

                <li class="list-inline-item">
                  <a class="btn btn-social-o twitter shtwitter" target="blank">
                    <i class="fa-brands fa-twitter"></i>
                    <span>Twitter</span>
                  </a>
                </li>

                <li class="list-inline-item">
                  <a class="btn btn-social-o whatsapp shwhatsapp" target="blank">
                    <i class="fa-brands fa-whatsapp"></i>
                    <span>WhatsApp</span>
                  </a>
                </li>

                <li class="list-inline-item">
                  <a class="btn btn-social-o telegram shtelegram" target="blank">
                    <i class="fa-brands fa-telegram"></i>
                    <span>Telegram</span>
                  </a>
                </li>

                <li class="list-inline-item">
                  <a class="btn btn-linkedin-o linkedin shlinkedin" target="blank">
                    <i class="fa-brands fa-linkedin-in"></i>
                    <span>LinkedIn</span>
                  </a>
                </li>

                <li class="list-inline-item">
                  <a class="btn btn-social-o instagram shinstagram" target="blank">
                    <i class="fa-brands fa-instagram"></i>
                    <span>Instagram</span>
                  </a>
                </li>





              </ul>

            </div>

            <div class="Blog-detail-Block">
              <%- blog.details%>
            </div>

            <% if (blog.attachments && blog.attachments.length > 0) { %>
            <h2>Attachments</h2>
            <ul>
              <% blog.attachments.forEach(function(attachment) { %>
              <li>
                <i class="fa-solid fa-paperclip"></i>
                <a href="<%= attachment.path.replace('attachments\\', '') %>"><%= attachment.filename %></a>
              </li>
              <% }); %>
            </ul>
            <% } %>



            <div class="clearfix"></div>

            <% if(blog.tags.length >0) {%>
            <div class="col-md-10 mx-auto">
              <div class="text-center">
                <!-- News Tags -->
                <div class="blog-tags">
                  <ul class="list-inline">
                    <li class="list-inline-item">
                      <i class="fa fa-tags">
                      </i>
                    </li>

                    <% blog.tags.forEach(tag => { %>
                    <li class="list-inline-item">
                      <span><%= tag %></span>
                    </li>
                    <% }); %>


                  </ul>
                </div>
              </div>
              <!-- Profile author -->
              <div class="clearfix"></div>
            </div>
            <% }%>


            <div class="col-lg-6 mx-auto">
              <% if (blog.autor && blog.autor.fullname) { %>
              <div class="wrap__profile">
                <div class="wrap__profile-author">
                  <figure>

                    <% if (blog.autor.autorIMGpath !== "images/Default-profile.jpg") { %>
                    <img src="<%= blog.autor.autorIMGpath.replace('attachments\\', '') %>" alt="">
                    <% } else { %>
                    <img src="<%= blog.autor.autorIMGpath %>" alt="">
                    <% } %>

                  </figure>
                  <div class="wrap__profile-author-detail">
                    <div class="wrap__profile-author-detail-name">author</div>
                    <h4><%= blog.autor.fullname%></h4>
                    <p><%= blog.autor.expertise%></p>

                    <ul class="list-inline">
                      <% if (blog.autor.socialmedia.facebook) { %>
                      <li class="list-inline-item">
                        <a href="<%= blog.autor.socialmedia.facebook %>" class="btn btn-social btn-social-o facebook ">
                          <i class="fa-brands fa-facebook-f"></i>
                        </a>
                      </li>
                      <% } %>
                      <% if (blog.autor.socialmedia.twitter) { %>
                      <li class="list-inline-item">
                        <a href="<%= blog.autor.socialmedia.twitter %>" class="btn btn-social btn-social-o twitter ">
                          <i class="fa-brands fa-twitter"></i>
                        </a>
                      </li>
                      <% } %>

                      <% if (blog.autor.socialmedia.instagram) { %>
                      <li class="list-inline-item">
                        <a href="<%= blog.autor.socialmedia.instagram %>" class="btn btn-social btn-social-o instagram ">
                          <i class="fa-brands fa-instagram"></i>
                        </a>
                      </li>
                      <% } %>

                      <% if (blog.autor.socialmedia.whatsapp) { %>
                      <li class="list-inline-item">
                        <a href="<%= blog.autor.socialmedia.whatsapp %>" class="btn btn-social btn-social-o whatsapp ">
                          <i class="fa-brands fa-whatsapp"></i>
                        </a>
                      </li>
                      <% } %>

                      <% if (blog.autor.socialmedia.telegram) { %>
                      <li class="list-inline-item">
                        <a href="<%= blog.autor.socialmedia.telegram %>" class="btn btn-social btn-social-o telegram ">
                          <i class="fa-brands fa-telegram"></i>
                        </a>
                      </li>
                      <% } %>

                      <% if (blog.autor.socialmedia.linkedin) { %>
                      <li class="list-inline-item">
                        <a href="<%= blog.autor.socialmedia.linkedin %>" class="btn btn-social btn-social-o linkedin ">
                          <i class="fa-brands fa-linkedin-in"></i>
                        </a>
                      </li>
                      <% } %>
                    </ul>




                  </div>
                </div>
              </div>
              <% } %>
              <div class="clearfix"></div>
            </div>



            <div class="col-md-10 mx-auto">

              <!-- Comment  -->
              <div id="comments" class="comments-area">
                <h3 class="comments-title"><span id="TCC"><%= totalComments %></span> Comments:</h3>

                <ol class="comment-list">
                  <% mainComments.forEach(comment => { %>
                  <li class="comment">
                    <!-- all principale_comment -->
                    <aside class="comment-body">
                      <div class="comment-meta">
                        <div class="comment-author">
                          <img src="images/Default-profile.jpg" class="avatar" alt="image">
                          <p><b class="fn" data-toid="<%= comment.principale_comment.idP %>"><%= comment.principale_comment.name %></b></p>
                        </div>
                        <div class="comment-metadata">
                          <span><%= new Date(comment.principale_comment.date_comment).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) %> AT <%= new Date(comment.principale_comment.date_comment).toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric' }) %></span>
                        </div>
                      </div>
                      <div class="comment-content">
                        <p><%= comment.principale_comment.comment %></p>
                      </div>
                      <div class="reply">
                        <a class="comment-reply-link" data-idP="<%= comment.principale_comment.idP %>">Reply</a>
                      </div>
                    </aside>
                    <ol class="children">
                      <% let replycount = 0; %>
                      <!-- all  replies_comments -->
                      <% comment.principale_comment.replies_comments.forEach(reply => { %>
                      <%  replycount += 1; %>


                      <li class="comment <%  if(replycount > 1){%> <%= "d-none" %> <%}%>">
                        <aside class="comment-body">
                          <div class="comment-meta">
                            <div class="comment-author">
                              <img src="images/Default-profile.jpg" class="avatar" alt="image">
                              <p><b class="fn" data-toid="<%= reply.idR %>"><%= reply.name %></b><i class=" fa-regular fa-reply"></i> <%= reply.to %></p>
              </div>
              <div class="comment-metadata">
                <span><%= new Date(reply.date_reply).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) %> AT <%= new Date(reply.date_reply).toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric' }) %></span>
              </div>
            </div>
            <div class="comment-content">
              <p><%= reply.comment %></p>
            </div>
            <div class="reply">
              <a class="comment-reply-link" data-idP="<%= comment.principale_comment.idP %>">Reply</a>
            </div>
            </aside>
            </li>

            <% }); %>
            </ol>
            <%  if(replycount > 1){%>
            <div class="row">
              <div class="col-12 text-center">
                <a class="load-more-reply" onclick="show_replies(this)">Show More Replies (<%= replycount-1 %>)</a>
              </div>
            </div>
            <%}%>
            </li>
            <% }); %>
            </ol>
            <%  if (totalComments - totalccm  > 0) { %>
            <div class="row">
              <div class="col-12 text-center">
                <a id="load-more-comments">Show More (<%= totalComments - totalccm %>)</a>
              </div>
            </div>
            <%  } %>



            <div class="comment-respond">
              <h3 class="comment-reply-title">Leave a Reply</h3>

              <form id="commentpForm" action="/blogs/<%= blog._id %>/comment" method="post" class="comment-form">
                <p class="comment-notes">
                  <span id="email-notes">Your email address will not be published.</span>
                  Required fields are marked
                  <span class="required">*</span>
                </p>
                <p class="comment-form-comment">
                  <label for="comment">Comment</label>
                  <textarea name="comment" id="comment" cols="45" rows="5" maxlength="65525" required="required"></textarea>
                </p>
                <p class="comment-form-author">
                  <label>Name <span class="required">*</span></label>
                  <input type="text" name="name" required="required">
                </p>
                <p class="comment-form-email">
                  <label for="email">Email <span class="required">*</span></label>
                  <input type="email" id="email" name="email" required="required">
                </p>
                <p class="comment-form-url">
                  <label for="url">Website</label>
                  <input type="url" id="url" name="website">
                </p>
                <p class="comment-form-cookies-consent">
                  <input type="checkbox" value="yes" name="receive_news" id="wp-comment-cookies-consent">
                  <label for="wp-comment-cookies-consent">Save my name, email, and website in
                    this browser for the next
                    span I comment.</label>
                </p>
                <p class="form-submit">
                  <button type="submit" id="submit" class="submit">Post Comment</button>
                </p>
              </form>
            </div>
          </div>
          <!-- Comment -->

          <div class="row">
            <div class="col-md-6">
              <div class="single_navigation-prev mb-5">
                <% if (prevBlog) { %>
                <a href="/blogs/<%= prevBlog._id %>">
                  <span>previous post</span>
                  <%= prevBlog.title %>
                </a>
                <% } %>
              </div>
            </div>
            <div class="col-md-6">
              <div class="single_navigation-next text-left text-md-right mb-5">
                <% if (nextBlog) { %>
                <a href="/blogs/<%= nextBlog._id %>">
                  <span>next post</span>
                  <%= nextBlog.title %>
                </a>
                <% } %>
              </div>
            </div>
          </div>
          <div class="clearfix"></div>
        </div>





      </div>
    </div>
    </div>
    </div>
  </section>

  <div id="custom-toast-template" style="display: none; ">
    <div class="spinner-border text-dark" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="color-white"> currently being create <br>Do not refresh or change this page</p>
  </div>
  </div>



  <%- include('./commun/footer') %>
  <!-- 
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const ngrokUrl = "https://61fc-102-156-53-177.ngrok-free.app"; // Ngrok URL from your session
      const msg = encodeURIComponent(document.querySelector('.Blog-detail-Block').textContent);
      const title = encodeURIComponent(document.querySelector('.Blog-title-Block').textContent);
      const fb = document.querySelector('.shfacebook');
      fb.href = `https://www.facebook.com/sharer/sharer.php?u=${ngrokUrl}/blogs/660499cd76cccf5f73cb22af&title=${title}&quote=${msg}`;
    });
  </script> -->

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const ngrokUrl = encodeURI(window.location.href); //"https://97e0-102-156-53-177.ngrok-free.app"; // Ngrok URL from your session
      const msg = encodeURIComponent(document.querySelector('.Blog-detail-Block').textContent);
      const title = encodeURIComponent(document.querySelector('.Blog-title-Block').textContent);

      document.querySelector('.shfacebook').href = `https://www.facebook.com/sharer/sharer.php?u=${ngrokUrl}/blogs/660499cd76cccf5f73cb22af&title=${title}&quote=${msg}`;

      document.querySelector('.shtwitter').href = `https://twitter.com/intent/tweet?url=${ngrokUrl}/blogs/660499cd76cccf5f73cb22af&text=${title}&via=your_twitter_handle`;

      document.querySelector('.shwhatsapp').href = `https://api.whatsapp.com/send?text=${title} ${ngrokUrl}/blogs/660499cd76cccf5f73cb22af`;

      document.querySelector('.shtelegram').href = `https://t.me/share/url?url=${ngrokUrl}/blogs/660499cd76cccf5f73cb22af&text=${title}`;

      document.querySelector('.shlinkedin').href = `https://www.linkedin.com/sharing/share-offsite/?url=${ngrokUrl}/blogs/660499cd76cccf5f73cb22af`;

      document.querySelector('.shinstagram').href = `https://www.instagram.com/share?url=${ngrokUrl}/blogs/660499cd76cccf5f73cb22af&title=${title}`;
    });
  </script>
  <script>
    function clearFormFields() {
      var fieldsToClear = document.querySelectorAll('input[type=text], input[type=email], textarea, input[type=url]');
      fieldsToClear.forEach(function(input) {
        input.value = '';
      });
    }


    function showMessage(msg, duration, color) {
      Toastify({
        text: msg,
        close: true,
        duration: duration,
        gravity: "bottom",
        position: "right",
        backgroundColor: color,
      }).showToast()
    }
    // Function to show a Toastify notification with a spinner
    function showSpinnerToast(message) {
      var toast = Toastify({
        text: document.getElementById('custom-toast-template').innerHTML,
        duration: -1, // Infinite duration
        gravity: "bottom",
        position: "right",
        className: 'toastify-spinner',
        escapeMarkup: false,
        closeOnClick: true,
        backgroundColor: "#007bff",
      }).showToast();
      // Return the toast instance
      return toast;
    }
  </script>
  <script>
    function incrementValue() {
      // Get the span element by its ID
      var spanElement = document.getElementById('TCC');

      // Get the current value as a number and increment it by 1
      var currentValue = parseInt(spanElement.innerText);
      var newValue = currentValue + 1;

      // Update the span element with the new value
      spanElement.innerText = newValue;
    }
    $(document).ready(function() {
      $('#commentpForm').submit(function(e) {
        e.preventDefault(); // Prevent default form submission
        var toastInstance = showSpinnerToast("Posting...");

        var form = $(this);
        var formData = form.serialize(); // Serialize form data
        $.ajax({
          type: form.attr('method'),
          url: form.attr('action'),
          data: formData,
          success: function(response) {
            toastInstance.hideToast();
            if (response.errors && response.errors.length > 0) {
              response.errors.forEach(error => {
                showMessage(error, 3000, "#dc3545");
              });

            }
            if (response.message && response.message.length > 0) {
              clearFormFields();
              showMessage(response.message, -1, "#4fbe87");
              const parsedFormData = new URLSearchParams(formData);
              const comment = parsedFormData.get('comment');
              const name = parsedFormData.get('name');
              const email = parsedFormData.get('email');
              const commentBlock = `<li class="comment"> <aside class="comment-body"> <div class="comment-meta"> <div class="comment-author"> <img src="images/Default-profile.jpg" class="avatar" alt="image"> <p><b class="fn" data-toid="${response.idP}">${name}</b></p> </div> <div class="comment-metadata"> <span>${response.pDate}</span> </div> </div> <div class="comment-content"> <p>${comment}</p> </div> <div class="reply"> <a class="comment-reply-link" data-idP="${response.idP}">Reply</a> </div> </aside> <ol class="children"></ol> </li>`;

              $('.comment-list').append(commentBlock);
              incrementValue();


            }
          },
          error: function(xhr, status, error) {
            const errorMessage = JSON.parse(xhr.responseText).errors[0];
            toastInstance.hideToast();
            showMessage(errorMessage, 3000, "#dc3545");
          }
        });
      });
    });
  </script>

  <script>
    function removeForm(elm) {
      const formElement = elm.closest('.rcomment-respond');
      const replyLink = formElement.previousElementSibling.querySelector('.comment-reply-link');
      replyLink.closest('.reply').classList.remove('d-none');
      formElement.remove();
    }
    // Wait for the document to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Add a click event listener to the document
      document.addEventListener('click', function(event) {
        // Check if the clicked element has the class "comment-reply-link"
        if (event.target.classList.contains('comment-reply-link')) {
          // Get the parent element with the class "reply" and add the class "d-none"
          const replyElement = event.target.closest('.reply');
          if (replyElement) {
            replyElement.classList.add('d-none');
            const closestComment = event.target.closest('.comment-body');
            // Get the name element within the parent element
            const nameElement = closestComment.querySelector('.comment-author .fn');
            const toid = nameElement.getAttribute('data-toid');

            // Get the text content of the name element
            const nameto = nameElement.textContent;

            // Check if a matching ancestor element was found
            if (closestComment) {
              const existingForm = document.querySelector('.rcomment-respond');
              if (existingForm) {
                const replyLink = existingForm.previousElementSibling.querySelector('.comment-reply-link');
                replyLink.closest('.reply').classList.remove('d-none');
                existingForm.remove();
              }
              // Create a new element for the HTML code
              const commentRespond = document.createElement('div');
              commentRespond.classList.add('comment-respond', 'rcomment-respond');
              const dataIdPValue = event.target.getAttribute('data-idP');
              commentRespond.innerHTML = `<form id="commentRForm" action="/blogs/" method="post" class="comment-form" data-toid="${toid}" data-to="${nameto}"  data-idP="${dataIdPValue}"> <p class="comment-form-comment"> <label for="comment">Comment</label> <textarea name="comment" id="comment" cols="25" rows="3" maxlength="65525" required="required"></textarea> </p> <p class="comment-form-author"> <label>Name <span class="required">*</span></label> <input type="text" name="name" required="required"> </p> <p class="comment-form-email"> <label for="email">Email <span class="required">*</span></label> <input type="email" id="email" name="email" required="required"> </p> <p class="comment-form-url"> <label for="url">Website</label> <input type="url" id="url" name="website"> </p> <p class="comment-form-cookies-consent"> <input type="checkbox" value="yes" name="receive_news" id="wp-comment-cookies-consent"> <label for="wp-comment-cookies-consent">Save my name, email, and website in this browser for the next span I comment.</label> </p> <p class="form-submit"> <button type="submit" id="submit" class="submit">Replay</button> <span onclick="removeForm(this)">Cancel</span> </p> </form>`;

              // Append the new element to the closest "comment" ancestor
              closestComment.appendChild(commentRespond);
            }
          }
        }
      });
    });
  </script>

  <!--   <script>
    $(document).ready(function() {
      $('#commentRForm').submit(function(e) {
        e.preventDefault(); // Prevent default form submission
        var toastInstance = showSpinnerToast("Posting...");

        var form = $(this);
        var formData = form.serialize(); // Serialize form data
        $.ajax({
          type: form.attr('method'),
          url: form.attr('action') + "<%= blog._id || null %>" + "/Rcomment",
          data: formData,
          success: function(response) {
            toastInstance.hideToast();
            if (response.errors && response.errors.length > 0) {
              response.errors.forEach(error => {
                showMessage(error, 3000, "#dc3545");
              });

            }
            if (response.message && response.message.length > 0) {
              clearFormFields();
              showMessage(response.message, -1, "#4fbe87");
            }
          },
          error: function(xhr, status, error) {
            const errorMessage = JSON.parse(xhr.responseText).errors[0];
            toastInstance.hideToast();
            showMessage(errorMessage, 3000, "#dc3545");
          }
        });

      });
    });
  </script>
 -->
  <script>
    $(document).ready(function() {
      // Event listener for submitting the reply form via AJAX
      $(document).on('submit', '#commentRForm', function(e) {
        e.preventDefault(); // Prevent default form submission
        var parentDiv = $(this).closest('div');
        //console.log(parentDiv);
        parentDiv.prev('.reply').removeClass('d-none');

        // Show loading spinner
        var toastInstance = showSpinnerToast("Posting...");

        // Serialize form data and add the 'data-to' value
        // Serialize the form data
        var formData = $(this).serializeArray();

        // Get the value of the 'data-to' attribute
        var dataTo = $(this).data('to');
        formData.push({
          name: 'data_to',
          value: dataTo
        });

        // Get the value of the 'data-idP' attribute
        var dataIdP = $(this).data('idp');
        formData.push({
          name: 'data_idP',
          value: dataIdP
        });
        // Get the value of the 'data-toid' attribute
        var datatoid = $(this).data('toid');
        formData.push({
          name: 'data_toid',
          value: datatoid
        });

        // Convert the formData array into URL-encoded string
        formData = $.param(formData);

        // AJAX request
        $.ajax({
          type: $(this).attr('method'),
          url: $(this).attr('action') + "<%= blog._id || null %>" + "/Rcomment",
          data: formData,
          success: function(response) {
            toastInstance.hideToast(); // Hide loading spinner

            if (response.errors && response.errors.length > 0) {
              // Display error messages if any
              response.errors.forEach(error => {
                showMessage(error, 3000, "#dc3545");
              });
            }

            if (response.message && response.message.length > 0) {
              clearFormFields(); // Clear form fields on successful submission
              showMessage(response.message, -1, "#4fbe87"); // Show success message
              //console.log(response.idR);
              const htmlElm = parentDiv.closest('.children');
              const parsedFormData = new URLSearchParams(formData);
              const comment = parsedFormData.get('comment');
              const name = parsedFormData.get('name');
              const email = parsedFormData.get('email');
              const IDR = response.idR;

              const to_dest = '<i class="fa-regular fa-reply"></i> ' + response.data_to;


              // Construct the HTML block
              const commentBlock = `<li class="comment"> <aside class="comment-body"> <div class="comment-meta"> <div class="comment-author"> <img src="images/Default-profile.jpg" class="avatar" alt="image"> <p><b class="fn" data-toid="${IDR}">${name}</b> ${to_dest} </p> </div> <div class="comment-metadata"> <span>${response.pDate}</span> </div> </div> <div class="comment-content"> <p>${comment}</p> </div> <div class="reply"> <a class="comment-reply-link" data-idP="${response.data_idP}">Reply</a> </div> </aside>  </li>`;


              if (htmlElm && htmlElm.attr('class') != undefined) {
                htmlElm.append(commentBlock);
              } else {
                var commentElement = parentDiv.closest('.comment'); // Find closest .comment element
                var pchildren = commentElement.find('.children'); // Find .children within the commentElement
                pchildren.append(commentBlock); // Append commentBlock to pchildren
              }

              //console.log(commentBlock);


              parentDiv.remove();
              incrementValue();
            }
          },
          error: function(xhr, status, error) {
            // Display error message in case of AJAX error
            const errorMessage = JSON.parse(xhr.responseText).errors[0];
            toastInstance.hideToast(); // Hide loading spinner
            showMessage(errorMessage, 3000, "#dc3545");
          }
        });


      });
    });
  </script>


  <script>
    function createCommentHTML(commentData) {
      let replycount = 0;
      const commentHTML = `
    <li class="comment">
      <aside class="comment-body">
        <div class="comment-meta">
          <div class="comment-author">
            <img src="images/Default-profile.jpg" class="avatar" alt="image">
            <b class="fn" data-toid="${commentData.principale_comment.idP}">${commentData.principale_comment.name}</b>
          </div>
          <div class="comment-metadata">
            <span>${new Date(commentData.principale_comment.date_comment).toLocaleString()}</span>
          </div>
        </div>
        <div class="comment-content">
          <p>${commentData.principale_comment.comment}</p>
        </div>
        <div class="reply">
          <a class="comment-reply-link" data-idp="${commentData.principale_comment.idP}">Reply</a>
        </div>
      </aside>
      <ol class="children">
        ${commentData.principale_comment.replies_comments.map(reply => {
          replycount += 1;
          return `
            <li class="comment ${replycount > 1 ? 'd-none' : ''}">
              <aside class="comment-body">
                <div class="comment-meta">
                  <div class="comment-author">
                    <img src="images/Default-profile.jpg" class="avatar" alt="image">
                    <p><b class="fn" data-toid=${reply.idR}>${reply.name}</b><i class="fa-regular fa-reply"></i> ${reply.to}</p>
                  </div>
                  <div class="comment-metadata">
                    <span>${new Date(reply.date_reply).toLocaleString()}</span>
                  </div>
                </div>
                <div class="comment-content">
                  <p>${reply.comment}</p>
                </div>
                <div class="reply">
                  <a class="comment-reply-link" data-idp="${commentData.principale_comment.idP}">Reply</a>
                </div>
              </aside>
            </li>
          `;
        }).join('')}
      </ol>
      ${replycount > 1 ? `
        <div class="row">
          <div class="col-12 text-center">
            <a class="load-more-reply" onclick="show_replies(this)">Show More Replies (${replycount - 1})</a>
          </div>
        </div>
      ` : ''}
    </li>
  `;

      return commentHTML;
    }



    const loadMoreButton = document.getElementById('load-more-comments');
    let skip = 2; // Nombre de commentaires à sauter lors du chargement suivant
    const limit = 2; // Limite de commentaires à charger par défaut

    // Fonction pour charger les commentaires supplémentaires
    async function loadMoreComments() {
      const response = await fetch(`/blogs/<%= blog._id || null %>/comments?skip=${skip}&limit=${limit}`);
      const comments = await response.json();
      /*       if (comments.comments.length === 0){
              loadMoreButton.remove();
              return;
            } */

      const commentList = document.querySelector(".comment-list");

      comments.comments.forEach(commentData => {
        var commentHTML = createCommentHTML(commentData);
        commentList.innerHTML += commentHTML;
      });



      skip += comments.comments.length;
      if (comments.TTC > 0) {
        document.getElementById('load-more-comments').innerText = "Show More (" + comments.TTC + ")";
      } else {
        loadMoreButton.remove();
      }

    }
if(loadMoreButton){
  loadMoreButton.addEventListener('click', loadMoreComments);
}

  </script>

  <script>
    function show_replies(elm) {
      // Get the parent ol element with the class "comment"
      var parentOl = elm.closest('.comment');

      // Get all the li elements with the class "comment" and "d-none" inside the parent ol
      var hiddenListItems = parentOl.querySelectorAll('.children li.comment.d-none');

      // Loop through the hidden list items and remove the "d-none" class for the first two items
      for (var i = 0; i < 2 && i < hiddenListItems.length; i++) {
        hiddenListItems[i].classList.remove('d-none');
      }

      // Update the "Show More" link text and onclick function based on remaining hidden items
      var remainingHiddenItems = parentOl.querySelectorAll('li.comment.d-none');
      var showMoreLink = parentOl.querySelector('.load-more-reply');
      if (remainingHiddenItems.length > 0) {
        showMoreLink.textContent = 'Show More Replies (' + remainingHiddenItems.length + ')';
      } else {
        showMoreLink.remove();
      }
    }
  </script>





</body>

</html>