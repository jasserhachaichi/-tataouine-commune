<!DOCTYPE html>
<html lang="en">

<%- include('./commun/head') %>
<link rel="stylesheet" href="assets/extensions/filepond/filepond.css">
<link rel="stylesheet" href="assets/extensions/toastify-js/src/toastify.css">
<link rel="stylesheet" href="assets/extensions/summernote/summernote-lite.css">
<link rel="stylesheet" href="assets/compiled/css/form-editor-summernote.rtl.css">
<link rel="stylesheet" href="plugin/Tagify/tagify.css">

<body>
  <script src="assets/static/js/initTheme.js"></script>
  <div id="app">
    <%- include('./partials/sidebar') %>
    <div id="main">
      <%- include('./partials/header') %>
      <div class="page-heading">
        <div class="page-title">
          <div class="row">
            <div class="col-12 col-md-6 order-md-1 order-last">
              <h3>Add Blog</h3>
              <p class="text-subtitle text-muted">Create and publish new blog posts on the website.</p>
            </div>
            <div class="col-12 col-md-6 order-md-2 order-first">
              <nav aria-label="breadcrumb" class="breadcrumb-header float-start float-lg-end">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item"><a href="/dashhome">Dashboard</a></li>
                  <li class="breadcrumb-item active" aria-current="page">Add Blog</li>
                </ol>
              </nav>
            </div>
          </div>
        </div>



        <!-- // Basic multiple Column Form section start -->
        <section id="multiple-column-form">
          <div class="row match-height">
            <div class="col-12">
              <div class="card">
                <div class="card-content">
                  <div class="card-body">
                    <form id="blogForm" class="form" action="/addblog" method="post">
                      <div class="row">

                        <div class="col-12">
                          <div class="form-group  mandatory">
                            <label for="title-blog" class="form-label">Title</label>
                            <input type="text" id="title-blog" class="form-control" placeholder="title" name="title-blog" data-parsley-required="true">
                          </div>
                        </div>
                        <div class="col-12">
                          <div class="form-group mb-3">
                            <label for="subtitle" class="form-label">Subtitle</label>
                            <textarea class="form-control" id="subtitle" rows="3" name="subtitle"></textarea>
                          </div>
                        </div>

                        <div class="col-12">
                          <div class="form-group">
                            <label for="tags-blog" class="form-label">Tags</label>
                            <input id="tags-blog" class="form-control" name='tags-blog' autofocus>
                          </div>
                        </div>

                        <div class="col-md-6 col-12">
                          <div class="form-group">
                            <label class="form-label">Blog Cover Image</label>
                            <input id="filepondinput" class="filepondinput1" type="file" name="filepond" />
                          </div>
                        </div>
                        <div class="col-md-6 col-12">
                          <div class="form-group">
                            <label class="form-label">Attachements</label>
                            <input id="filepondinput" class="filepondinput2" type="file" name="filepond2" multiple />
                          </div>
                        </div>

                        <div class="divider">
                          <div class="divider-text">Autor</div>
                        </div>

                        <div class="col-md-6 col-12">
                          <div class="form-group">
                            <label for="full-name"  class="form-label">Full Name</label>
                            <input type="text" id="full-name" class="form-control" placeholder="Full Name" name="full-name">
                          </div>
                        </div>
                        <div class="col-md-6 col-12">
                          <div class="form-group">
                            <label for="expertise" class="form-label">Expertise</label>
                            <input type="text" id="expertise" class="form-control" placeholder="Expertise" name="expertise">
                          </div>
                        </div>
                        <div class="col-6">
                          <div class="form-group">
                            <label class="form-label">Profil Image</label>
                            <input id="filepondinput" class="filepondinput3" type="file" name="filepond3" />
                          </div>
                        </div>
                        <div class="divider">
                          <div class="divider-text">Autor Links</div>
                        </div>

                        <div class="col-md-6 col-12">
                          <div class="form-group has-icon-left">
                            <label for="In-link"  class="form-label">Linkedin</label>
                            <div class="position-relative">
                              <input type="text" class="form-control" placeholder="Linkedin Link" id="In-link" name="In-link">
                              <div class="form-control-icon">
                                <i class="bi bi-link-45deg"></i>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6 col-12">
                          <div class="form-group has-icon-left">
                            <label for="fb-link"  class="form-label">Facebook</label>
                            <div class="position-relative">
                              <input type="text" class="form-control" placeholder="Facebook Link" id="fb-link" name="fb-link">
                              <div class="form-control-icon">
                                <i class="bi bi-link-45deg"></i>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6 col-12">
                          <div class="form-group has-icon-left">
                            <label for="tw-link"  class="form-label">Twitter</label>
                            <div class="position-relative">
                              <input type="text" class="form-control" placeholder="Twitter Link" id="tw-link" name="tw-link">
                              <div class="form-control-icon">
                                <i class="bi bi-link-45deg"></i>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6 col-12">
                          <div class="form-group has-icon-left">
                            <label for="Ins-link"  class="form-label">Instagram</label>
                            <div class="position-relative">
                              <input type="text" class="form-control" placeholder="Instagram Link" id="Ins-link" name="Ins-link">
                              <div class="form-control-icon">
                                <i class="bi bi-link-45deg"></i>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6 col-12">
                          <div class="form-group has-icon-left">
                            <label for="wh-number"  class="form-label">Whatsapp</label>
                            <div class="position-relative">
                              <input type="text" class="form-control" placeholder="Whatsapp number" id="wh-number" name="wh-number">
                              <div class="form-control-icon">
                                <i class="bi bi-phone"></i>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6 col-12">
                          <div class="form-group has-icon-left">
                            <label for="telg-number"  class="form-label">Telegram</label>
                            <div class="position-relative">
                              <input type="text" class="form-control" placeholder="Telegram number" id="telg-number" name="telg-number">
                              <div class="form-control-icon">
                                <i class="bi bi-phone"></i>
                              </div>
                            </div>
                          </div>
                        </div>





                        <div class="divider">
                          <div class="divider-text">Blog Details</div>
                        </div>

                        <div class="col-12">
                          <div class="form-group">
                            <div id="summernote"></div>
                          </div>
                        </div>





                        <div class="col-12 d-flex justify-content-end">
                          <button id="submit-button" type="submit" class="btn btn-primary me-1 mb-1">Post</button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <!-- // Basic multiple Column Form section end -->
      </div>


      <%- include('./partials/footer') %>
    </div>
  </div>


  <%- include('./commun/scripts') %>

  <script src="assets/extensions/summernote/summernote-lite.min.js"></script>
  <script>
    $('#summernote').summernote({
      height: 800,
      fontSizes: ['8', '9', '10', '11', '12', '14', '18', '24', '36'],
      styleTags: [
        'p',
        {
          title: 'Blockquote',
          tag: 'blockquote',
          className: 'blockquote',
          value: 'blockquote'
        },
        'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'
      ],
      toolbar: [
        ['style', ['style']],
        ['font', ['bold', 'underline', 'italic', 'strikethrough', 'superscript', 'subscript', 'clear']],
        ['fontname', ['fontname']],
        ['fontsize', ['fontsize']],
        ['color', ['color']],
        ['para', ['ul', 'ol', 'paragraph']],
        ['insert', ['ltr', 'rtl']],
        ['height', ['height']],
        ['table', ['table']],
        ['insert', ['link', 'picture', 'video', 'hr']],
        ['misc', ['emoji']],
        ['view', ['fullscreen', 'undo', 'redo', 'codeview', 'help']]
      ],
    });
  </script>

  <script src="assets/extensions/filepond-plugin-file-validate-size/filepond-plugin-file-validate-size.min.js"></script>
  <script src="assets/extensions/filepond/filepond.js"></script>
  <script src="assets/extensions/toastify-js/src/toastify.js"></script>
  <script>
    // FilePond plugin registration and initialization
    FilePond.registerPlugin(FilePondPluginFileValidateSize);
    const pond = FilePond.create(document.querySelector(".filepondinput1"), {
      maxFileSize: '10MB',
      credits: null,
      acceptedFileTypes: ['image/*'] // Only allow image files
    });

    const pond2 = FilePond.create(document.querySelector(".filepondinput2"), {
      maxFileSize: '10MB',
      credits: null,
    });
    const pond3 = FilePond.create(document.querySelector(".filepondinput3"), {
      maxFileSize: '10MB',
      credits: null,
      acceptedFileTypes: ['image/*'] // Only allow image files
    });
  </script>

  <script>
    function viderInputs() {
      // Sélectionnez tous les champs de formulaire que vous souhaitez vider
      var inputsToClear = document.querySelectorAll('input[type=text]');
      document.getElementById('subtitle').value = "";

      // Parcourez chaque champ de formulaire et réinitialisez sa valeur à une chaîne vide
      inputsToClear.forEach(function(input) {
        input.value = '';
      });


      pond.removeFiles();
      pond2.removeFiles();
      pond3.removeFiles();

      // Si vous utilisez un éditeur WYSIWYG comme Summernote, vous devrez peut-être également le vider
      $('#summernote').summernote('code', '');

      // Reset the Tagify input by removing all tags
      tagify.removeAllTags();
    };



    function showMessage(msg, duration, color) {
      Toastify({
        text: msg,
        close: true,
        duration: duration,
        gravity: "bottom",
        position: "right",
        backgroundColor: color,
      }).showToast()
    }


    $(document).ready(function() {
      $('#blogForm').submit(function(e) {
        e.preventDefault(); // Prevent the default form submission
        // Disable the submit button and show loading text
        $('#submit-button').prop('disabled', true).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Posting blog...');


        var summernoteHTML = $('#summernote').summernote('code');
        //console.log(summernoteHTML);

        // Get files from FilePond instance
        const files = pond.getFiles();
        const files2 = pond2.getFiles();
        const files3 = pond3.getFiles();

        // Create FormData object and append files to it
        const formData = new FormData(this);
        files.forEach(file => {
          formData.append('filepond', file.file);
        });
        files2.forEach(file => {
          formData.append('filepond2', file.file);
        });
        files3.forEach(file => {
          formData.append('filepond3', file.file);
        });

        formData.append('summernote', summernoteHTML);

        // Send AJAX request
        $.ajax({
          type: 'POST',
          url: '/addblog', // The URL to your Express route
          data: formData,
          processData: false,
          contentType: false,
          success: function(response) {
            setTimeout(function() {
              viderInputs();
              showMessage(response, -1, "#4fbe87");
              $('#submit-button').prop('disabled', false).html('Post');
            }, 1000);


          },
          error: function(xhr, status, error) {
            if (xhr.responseJSON && xhr.responseJSON.errors) {
              const errors = xhr.responseJSON.errors;
              // Iterate through each error in the "errors" list
              errors.forEach(function(errorMsg) {
                // Handle each error as needed
                //console.error('Error:', errorMsg);
                showMessage(errorMsg, -1, "#dc3545");
              });
            }
            // Re-enable the submit button
            $('#submit-button').prop('disabled', false).html('Post');

          }
        });
      });
    });
  </script>

  <script src="plugin/Tagify/tagify.min.js"></script>
  <script>
    // The DOM element you wish to replace with Tagify
    var input = document.querySelector('input[name=tags-blog]');

    // initialize Tagify on the above input node reference
    var tagify = new Tagify(input);
  </script>
  <script src="assets/extensions/parsleyjs/parsley.min.js"></script>
  <script src="assets/static/js/pages/parsley.js"></script>
  <script>
    $(document).ready(function() {
      // Sélectionnez l'input fullname
      var $fullnameInput = $('input[name="full-name"]');

      // Sélectionnez les autres inputs
      var $inlinkInput = $('input[name="In-link"]');
      var $fblinkInput = $('input[name="fb-link"]');
      var $inslinkInput = $('input[name="Ins-link"]');

      var $telgnumberInput = $('input[name="telg-number"]');
      var $twlinkInput = $('input[name="tw-link"]');
      var $whnumberInput = $('input[name="wh-number"]');

      var $expertiseInput = $('input[name="expertise"]');
      var $filepondInput = $('input[name="filepond3"]');

      // Ajoutez un écouteur d'événements sur l'input fullname
      $fullnameInput.on('input', function() {
        // Vérifiez si l'input fullname est vide
        if ($(this).val().trim() === '') {
          // Désactivez les autres inputs s'il est vide
          $inlinkInput.prop('disabled', true);
          $fblinkInput.prop('disabled', true);
          $inslinkInput.prop('disabled', true);

          $telgnumberInput.prop('disabled', true);
          $twlinkInput.prop('disabled', true);
          $whnumberInput.prop('disabled', true);

          $expertiseInput.prop('disabled', true);
          $filepondInput.prop('disabled', true);
        } else {
          // Sinon, activez les autres inputs
          $inlinkInput.prop('disabled', false);
          $fblinkInput.prop('disabled', false);
          $inslinkInput.prop('disabled', false);

          $telgnumberInput.prop('disabled', false);
          $twlinkInput.prop('disabled', false);
          $whnumberInput.prop('disabled', false);

          $expertiseInput.prop('disabled', false);
          $filepondInput.prop('disabled', false);
        }
      });

      // Désactivez les autres inputs au chargement de la page si fullname est vide
      if ($fullnameInput.val().trim() === '') {
        $inlinkInput.prop('disabled', true);
        $fblinkInput.prop('disabled', true);
        $inslinkInput.prop('disabled', true);

        $telgnumberInput.prop('disabled', true);
        $twlinkInput.prop('disabled', true);
        $whnumberInput.prop('disabled', true);

        $expertiseInput.prop('disabled', true);
        $filepondInput.prop('disabled', true);
      }
    });
  </script>



</body>

</html>